// Generated by purs version 0.15.10
import * as Control_Applicative from "../Control.Applicative/index.js";
import * as Control_Apply from "../Control.Apply/index.js";
import * as Control_Bind from "../Control.Bind/index.js";
import * as Control_Monad_Rec_Class from "../Control.Monad.Rec.Class/index.js";
import * as Control_Monad_ST_Global from "../Control.Monad.ST.Global/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_Array_ST from "../Data.Array.ST/index.js";
import * as Data_Array_ST_Partial from "../Data.Array.ST.Partial/index.js";
import * as Data_Either from "../Data.Either/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_Identity from "../Data.Identity/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_List_NonEmpty from "../Data.List.NonEmpty/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_Newtype from "../Data.Newtype/index.js";
import * as Data_Nullable from "../Data.Nullable/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
import * as Data_String_Common from "../Data.String.Common/index.js";
import * as Data_Tuple from "../Data.Tuple/index.js";
import * as Data_Unit from "../Data.Unit/index.js";
import * as Effect_Unsafe from "../Effect.Unsafe/index.js";
import * as Parsing from "../Parsing/index.js";
import * as Parsing_Combinators from "../Parsing.Combinators/index.js";
import * as Parsing_String from "../Parsing.String/index.js";
import * as Unsafe_Coerce from "../Unsafe.Coerce/index.js";
var bind = /* #__PURE__ */ Control_Bind.bind(Parsing.bindParserT);
var pure = /* #__PURE__ */ Control_Applicative.pure(Parsing.applicativeParserT);
var tailRecM = /* #__PURE__ */ Control_Monad_Rec_Class.tailRecM(Parsing.monadRecParserT);
var apply = /* #__PURE__ */ Control_Apply.apply(Parsing.applyParserT);
var map = /* #__PURE__ */ Data_Functor.map(Parsing.functorParserT);
var fromJust = /* #__PURE__ */ Data_Maybe.fromJust();
var foldl = /* #__PURE__ */ Data_Foldable.foldl(Data_List_Types.foldableList);
var unwrap = /* #__PURE__ */ Data_Newtype.unwrap();
var discard = /* #__PURE__ */ Control_Bind.discard(Control_Bind.discardUnit);
var poke = /* #__PURE__ */ Data_Array_ST_Partial.poke();
var map1 = /* #__PURE__ */ Data_Functor.map(Data_Functor.functorFn);
var splitCapCombinator = function (dictMonad) {
    var anyTill = Parsing_String.anyTill(dictMonad);
    return function (sep) {
        var posSep = bind(Parsing.position)(function (v) {
            return bind(sep)(function (x) {
                return bind(Parsing.position)(function (v1) {
                    return pure(new Data_Tuple.Tuple(v.index, new Data_Tuple.Tuple(x, v1.index)));
                });
            });
        });
        var accum = function (v) {
            return bind(Parsing_Combinators.optionMaybe(Parsing_Combinators["try"](anyTill(posSep))))(function (v1) {
                if (v1 instanceof Data_Maybe.Just) {
                    var carry_unmatched = (function () {
                        if (v.carry instanceof Data_Maybe.Nothing) {
                            return v1.value0.value0;
                        };
                        if (v.carry instanceof Data_Maybe.Just) {
                            return Data_String_CodePoints.singleton(v.carry.value0) + v1.value0.value0;
                        };
                        throw new Error("Failed pattern match at Parsing.String.Replace (line 289, column 29 - line 291, column 59): " + [ v.carry.constructor.name ]);
                    })();
                    var $76 = v1.value0.value1.value1.value1 === v1.value0.value1.value0;
                    if ($76) {
                        return bind(Parsing_Combinators.optionMaybe(Parsing_String.anyCodePoint))(function (carryNext) {
                            var $77 = Data_Maybe.isJust(carryNext);
                            if ($77) {
                                return pure(new Control_Monad_Rec_Class.Loop({
                                    carry: carryNext,
                                    rlist: new Data_List_Types.Cons(new Data_Tuple.Tuple(carry_unmatched, v1.value0.value1.value1.value0), v.rlist),
                                    arraySize: (function () {
                                        var $78 = Data_String_Common["null"](carry_unmatched);
                                        if ($78) {
                                            return v.arraySize + 1 | 0;
                                        };
                                        return v.arraySize + 2 | 0;
                                    })()
                                }));
                            };
                            return pure(new Control_Monad_Rec_Class.Done({
                                carry: carryNext,
                                rlist: new Data_List_Types.Cons(new Data_Tuple.Tuple(carry_unmatched, v1.value0.value1.value1.value0), v.rlist),
                                arraySize: (function () {
                                    var $79 = Data_String_Common["null"](carry_unmatched);
                                    if ($79) {
                                        return v.arraySize + 1 | 0;
                                    };
                                    return v.arraySize + 2 | 0;
                                })()
                            }));
                        });
                    };
                    return pure(new Control_Monad_Rec_Class.Loop({
                        carry: Data_Maybe.Nothing.value,
                        rlist: new Data_List_Types.Cons(new Data_Tuple.Tuple(carry_unmatched, v1.value0.value1.value1.value0), v.rlist),
                        arraySize: (function () {
                            var $80 = Data_String_Common["null"](carry_unmatched);
                            if ($80) {
                                return v.arraySize + 1 | 0;
                            };
                            return v.arraySize + 2 | 0;
                        })()
                    }));
                };
                if (v1 instanceof Data_Maybe.Nothing) {
                    return pure(new Control_Monad_Rec_Class.Done({
                        carry: v.carry,
                        rlist: v.rlist,
                        arraySize: v.arraySize
                    }));
                };
                throw new Error("Failed pattern match at Parsing.String.Replace (line 286, column 44 - line 316, column 48): " + [ v1.constructor.name ]);
            });
        };
        return tailRecM(accum)({
            carry: Data_Maybe.Nothing.value,
            rlist: Data_List_Types.Nil.value,
            arraySize: 0
        });
    };
};
var splitCapT = function (dictMonad) {
    var bind2 = Control_Bind.bind(dictMonad.Bind1());
    var splitCapCombinator1 = splitCapCombinator(dictMonad);
    var pure2 = Control_Applicative.pure(dictMonad.Applicative0());
    return function (dictMonadRec) {
        var runParserT = Parsing.runParserT(dictMonadRec);
        return function (input) {
            return function (sep) {
                return bind2(runParserT(input)(apply(map(Data_Tuple.Tuple.create)(splitCapCombinator1(sep)))(Parsing_String.rest)))(function (v) {
                    if (v instanceof Data_Either.Left) {
                        return pure2(Data_List_NonEmpty.singleton(new Data_Either.Left(input)));
                    };
                    if (v instanceof Data_Either.Right) {
                        var term = Data_Maybe.maybe(v.value0.value1)(function (cp) {
                            return Data_String_CodePoints.singleton(cp) + v.value0.value1;
                        })(v.value0.value0.carry);
                        var $93 = Data_List["null"](v.value0.value0.rlist);
                        if ($93) {
                            var $94 = Data_String_Common["null"](term);
                            if ($94) {
                                return pure2(Data_List_NonEmpty.singleton(new Data_Either.Left(input)));
                            };
                            return pure2(Data_List_NonEmpty.singleton(new Data_Either.Left(term)));
                        };
                        return pure2(fromJust(Data_List_NonEmpty.fromList(foldl(function (ls) {
                            return function (v1) {
                                var $96 = Data_String_Common["null"](v1.value0);
                                if ($96) {
                                    return new Data_List_Types.Cons(new Data_Either.Right(v1.value1), ls);
                                };
                                return new Data_List_Types.Cons(new Data_Either.Left(v1.value0), new Data_List_Types.Cons(new Data_Either.Right(v1.value1), ls));
                            };
                        })((function () {
                            var $99 = Data_String_Common["null"](term);
                            if ($99) {
                                return Data_List_Types.Nil.value;
                            };
                            return new Data_List_Types.Cons(new Data_Either.Left(term), Data_List_Types.Nil.value);
                        })())(v.value0.value0.rlist))));
                    };
                    throw new Error("Failed pattern match at Parsing.String.Replace (line 229, column 70 - line 253, column 16): " + [ v.constructor.name ]);
                });
            };
        };
    };
};
var splitCapT1 = /* #__PURE__ */ splitCapT(Data_Identity.monadIdentity)(Control_Monad_Rec_Class.monadRecIdentity);
var splitCap = function (input) {
    return function (sep) {
        return unwrap(splitCapT1(input)(sep));
    };
};
var replaceT = function (dictMonad) {
    var pure2 = Control_Applicative.pure(dictMonad.Applicative0());
    var Bind1 = dictMonad.Bind1();
    var bind2 = Control_Bind.bind(Bind1);
    var splitCapCombinator1 = splitCapCombinator(dictMonad);
    var discard2 = discard(Bind1);
    var map2 = Data_Functor.map((Bind1.Apply0()).Functor0());
    return function (dictMonadRec) {
        var runParserT = Parsing.runParserT(dictMonadRec);
        var tailRecM1 = Control_Monad_Rec_Class.tailRecM(dictMonadRec);
        return function (input) {
            return function (sep) {
                var doST = function ($132) {
                    return pure2(Effect_Unsafe.unsafePerformEffect(Control_Monad_ST_Global.toEffect($132)));
                };
                return bind2(runParserT(input)(apply(map(Data_Tuple.Tuple.create)(splitCapCombinator1(sep)))(Parsing_String.rest)))(function (v) {
                    if (v instanceof Data_Either.Left) {
                        return pure2(input);
                    };
                    if (v instanceof Data_Either.Right) {
                        var term = Data_Maybe.maybe(v.value0.value1)(function (cp) {
                            return Data_String_CodePoints.singleton(cp) + v.value0.value1;
                        })(v.value0.value0.carry);
                        return bind2(doST((function () {
                            var $107 = Data_String_Common["null"](term);
                            if ($107) {
                                return Data_Array_ST.unsafeThaw(Data_Array.replicate(v.value0.value0.arraySize)(Data_Nullable["null"]));
                            };
                            return function __do() {
                                var arr = Data_Array_ST.unsafeThaw(Data_Array.replicate(v.value0.value0.arraySize + 1 | 0)(Data_Nullable["null"]))();
                                poke(v.value0.value0.arraySize)(Data_Nullable.notNull(term))(arr)();
                                return arr;
                            };
                        })()))(function (v1) {
                            var accum = function (v2) {
                                var v3 = Data_List.uncons(v2["rlist'"]);
                                if (v3 instanceof Data_Maybe.Nothing) {
                                    return pure2(new Control_Monad_Rec_Class.Done(Data_Unit.unit));
                                };
                                if (v3 instanceof Data_Maybe.Just) {
                                    return discard2(doST(poke(v2.index)(Data_Nullable.notNull(v3.value0.head.value1))(v1)))(function () {
                                        var $111 = Data_String_Common["null"](v3.value0.head.value0);
                                        if ($111) {
                                            return pure2(new Control_Monad_Rec_Class.Loop({
                                                index: v2.index - 1 | 0,
                                                "rlist'": v3.value0.tail
                                            }));
                                        };
                                        return discard2(doST(poke(v2.index - 1 | 0)(Data_Nullable.notNull(v3.value0.head.value0))(v1)))(function () {
                                            return pure2(new Control_Monad_Rec_Class.Loop({
                                                index: v2.index - 2 | 0,
                                                "rlist'": v3.value0.tail
                                            }));
                                        });
                                    });
                                };
                                throw new Error("Failed pattern match at Parsing.String.Replace (line 463, column 35 - line 473, column 63): " + [ v3.constructor.name ]);
                            };
                            return discard2(tailRecM1(accum)({
                                index: v.value0.value0.arraySize - 1 | 0,
                                "rlist'": v.value0.value0.rlist
                            }))(function () {
                                return map2(map1(Data_String_Common.joinWith(""))(Unsafe_Coerce.unsafeCoerce))(doST(Data_Array_ST.unsafeFreeze(v1)));
                            });
                        });
                    };
                    throw new Error("Failed pattern match at Parsing.String.Replace (line 444, column 70 - line 481, column 72): " + [ v.constructor.name ]);
                });
            };
        };
    };
};
var replaceT1 = /* #__PURE__ */ replaceT(Data_Identity.monadIdentity)(Control_Monad_Rec_Class.monadRecIdentity);
var replace = function (input) {
    return function (sep) {
        return unwrap(replaceT1(input)(sep));
    };
};
var breakCapT = function (dictMonad) {
    var anyTill = Parsing_String.anyTill(dictMonad);
    var map2 = Data_Functor.map(((dictMonad.Bind1()).Apply0()).Functor0());
    return function (dictMonadRec) {
        var runParserT = Parsing.runParserT(dictMonadRec);
        return function (input) {
            return function (sep) {
                var go = bind(anyTill(sep))(function (v) {
                    return bind(Parsing.getParserT)(function (v1) {
                        return pure(new Data_Tuple.Tuple(v.value0, new Data_Tuple.Tuple(v.value1, v1.value0)));
                    });
                });
                return map2(Data_Either.hush)(runParserT(input)(go));
            };
        };
    };
};
var breakCapT1 = /* #__PURE__ */ breakCapT(Data_Identity.monadIdentity)(Control_Monad_Rec_Class.monadRecIdentity);
var breakCap = function (input) {
    return function (sep) {
        return unwrap(breakCapT1(input)(sep));
    };
};
export {
    breakCap,
    breakCapT,
    splitCap,
    splitCapT,
    replace,
    replaceT
};
//# sourceMappingURL=index.js.map
